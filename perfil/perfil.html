<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VW Carregamento - Perfil</title>

  <!-- Estilos do projeto -->
  <link rel="stylesheet" href="../global/Sidebar.css">
  <link rel="stylesheet" href="../global/Header.css">
  <link rel="stylesheet" href="../global/Layout.css">
  <link rel="stylesheet" href="../global/DarkMode.css">
</head>

<body>
  <div class="container">

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2>VoltWay</h2>
      </div>
      <nav>
        <a href="../home/home.html"><span>In√≠cio</span></a>
        <a href="../mapa/mapa.html"><span>Mapa</span></a>
        <a href="../perfil/perfil.html" class="active"><span>Perfil</span></a>
        <a href="../assinatura/assinatura.html"><span>Assinatura</span></a>
      </nav>

      <div class="user-box">
        <p id="nomeUsuario">
          <span class="user-photo">
            <img src="../assets/foto.png" alt="Foto do usu√°rio" />
          </span>
          <span class="user-name">Usu√°rio</span>
          <button class="settings-icon">
            <img src="../assets/engrenagem.png" alt="Configura√ß√µes" width="20" height="20">
          </button>
        </p>
        <button class="logout-btn" onclick="logout()">Sair</button>
      </div>
    </aside>

    <!-- Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Bot√£o fixo -->
    <button id="toggleSidebar">‚ò∞</button>

    <!-- Conte√∫do principal -->
    <main class="main">
      <!-- Cabe√ßalho -->
      <section class="header">
        <div class="header-top">
          <img src="../assets/logo.png" alt="Logo" class="header-logo" />
          <div class="header-text">
            <h1>Perfil do Usu√°rio</h1>
            <p>Gerencie suas informa√ß√µes pessoais, ve√≠culo e prefer√™ncias.</p>
          </div>
        </div>
      </section>

      <!-- Foto do Usu√°rio -->
      <section class="card perfil-container perfil-foto-container">
        <div class="perfil-foto">
          <img src="../assets/foto.png" id="fotoUsuario" alt="Foto do usu√°rio">
          <div style="margin-top:8px;">
            <button id="btnUploadFoto" class="btn">Alterar Foto</button>
            <button id="btnRemoverFoto" class="btn btn-ghost" style="margin-left:8px;">Remover</button>
          </div>
        </div>
        <!-- input file escondido -->
        <input type="file" id="inputFoto" accept="image/*" style="display:none" />
      </section>

      <!-- Informa√ß√µes do Usu√°rio -->
      <section class="card perfil-container">
        <h2>Informa√ß√µes do Usu√°rio</h2>
        <div id="userDetalhes" class="vehicle-fields"></div>
        <div id="perfilActions" class="form-actions hidden">
          <button id="btnSalvarPerfil">Salvar</button>
          <button id="btnCancelarPerfil" class="btn-cancelar">Cancelar</button>
        </div>
      </section>

      <!-- Ve√≠culo do Usu√°rio -->
      <section class="card vehicle">
        <h2>Meu Ve√≠culo</h2>
        <div class="vehicle-info">
          <img src="../assets/carro.png" alt="Carro El√©trico Gen√©rico">
          <div id="veiculoDetalhes">
            <div class="vehicle-fields">
              <div class="field-row"><label>Modelo:</label><span id="veiculoModelo">----</span></div>
              <div class="field-row"><label>Ano:</label><span id="veiculoAno">----</span></div>
              <div class="field-row"><label>Placa:</label><span id="veiculoPlaca">----</span></div>
              <div class="field-row"><label>Bateria:</label><span id="veiculoBateria">---- kWh</span></div>
              <div class="field-row"><label>Pot√™ncia de Carga:</label><span id="veiculoCarregamento">---- kW</span>
              </div>
            </div>
          </div>
          <!-- Bot√£o de edi√ß√£o -->
          <div class="editar-wrapper">
            <button id="btnEditarVeiculo" class="btn-editar">Editar Ve√≠culo</button>
          </div>
        </div>
      </section>

      <!-- Prefer√™ncias -->
      <section class="card perfil-container">
        <h2>Prefer√™ncias</h2>
        <p>Notifica√ß√µes: Ativadas</p>

        <div class="theme-toggle">
          <span>Tema Escuro</span>
          <label class="switch">
            <!-- added data-theme-toggle attribute for robust selector -->
            <input type="checkbox" id="darkModeSwitch" data-theme-toggle>
            <span class="slider"></span>
          </label>
        </div>

        <p>Localiza√ß√£o Autom√°tica: Ativada</p>
      </section>

      <!-- Hist√≥rico de Reservas -->
      <section id="historicoReservas" class="card perfil-container">
        <h2>Hist√≥rico de Reservas</h2>
        <ul>
          <li>üìç Esta√ß√£o Av. Paulista - 02/09/2025 - 15:00</li>
          <li>üìç Esta√ß√£o Shopping Morumbi - 28/08/2025 - 19:30</li>
          <li>üìç Esta√ß√£o Aeroporto GRU - 20/08/2025 - 10:00</li>
        </ul>
        <button class="btn">Ver Mais</button>
      </section>
    </main>
  </div>

  <!-- A√ß√£o do bot√£o da engrenagem (gearBtn) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const scrollTarget = localStorage.getItem("scrollToPerfilSection");
      if (scrollTarget) {
        const alvo = document.getElementById(scrollTarget);
        if (alvo) {
          setTimeout(() => {
            const targetY = alvo.getBoundingClientRect().top + window.scrollY;
            window.scrollTo({ top: targetY, behavior: "smooth" });
          }, 200); // espera a p√°gina renderizar
        }
        localStorage.removeItem("scrollToPerfilSection");
      }
    });
  </script>

  <!-- scripts -->
  <script src="../home/js/main.js"></script>
  <script src="perfil.js"></script>
  <script src="../global/Global.js"></script>

  <script>
    /*
      Global theme toggle logic (default = light)
      - Uses data-theme="dark" on <html> to match your CSS variables ([data-theme="dark"] {...})
      - Also keeps a .dark-mode class on <body> for compatibility if used elsewhere
      - Saves preference in localStorage key: "siteTheme" with values "light" or "dark"
      - Works with checkbox inputs having id="darkModeSwitch" OR attribute data-theme-toggle
      - Ensures pages start in LIGHT mode unless user previously chose dark
    */
    (function () {
      const LS_KEY = "siteTheme";

      // Apply theme consistently
      function applyTheme(theme) {
        if (theme === "dark") {
          document.documentElement.setAttribute("data-theme", "dark");
          document.body.classList.add("dark-mode");
        } else {
          document.documentElement.removeAttribute("data-theme");
          document.body.classList.remove("dark-mode");
        }
        // keep all toggles in sync (checked when dark)
        const toggles = document.querySelectorAll('input[type="checkbox"][data-theme-toggle], input[type="checkbox"]#darkModeSwitch');
        toggles.forEach(t => {
          t.checked = (theme === "dark");
        });
      }

      // Read saved preference (only "dark" triggers dark mode); default = light
      function getSavedTheme() {
        try {
          const v = localStorage.getItem(LS_KEY);
          if (v === "dark") return "dark";
        } catch (e) {
          // ignore storage errors (e.g. private mode)
        }
        return "light";
      }

      // Save preference
      function saveTheme(theme) {
        try {
          localStorage.setItem(LS_KEY, theme);
        } catch (e) { /* ignore */ }
      }

      // Toggle handler
      function onToggleChange(e) {
        const theme = e.target.checked ? "dark" : "light";
        applyTheme(theme);
        saveTheme(theme);
      }

      // Init after DOM ready
      function initThemeToggle() {
        const initial = getSavedTheme(); // default will be 'light' if nothing saved
        applyTheme(initial);

        // Find toggles (both id and data attribute)
        const toggles = Array.from(document.querySelectorAll('input[type="checkbox"][data-theme-toggle], input[type="checkbox"]#darkModeSwitch'));

        // Attach listeners if found, else observe for future additions
        if (toggles.length === 0) {
          const mo = new MutationObserver((mutations, obs) => {
            const found = Array.from(document.querySelectorAll('input[type="checkbox"][data-theme-toggle], input[type="checkbox"]#darkModeSwitch'));
            if (found.length > 0) {
              found.forEach(el => {
                el.checked = (initial === "dark");
                el.addEventListener("change", onToggleChange);
              });
              obs.disconnect();
            }
          });
          mo.observe(document.documentElement, { childList: true, subtree: true });
        } else {
          toggles.forEach(el => {
            el.checked = (initial === "dark");
            el.addEventListener("change", onToggleChange);
          });
        }
      }

      // Wait DOMContentLoaded to ensure inputs exist
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initThemeToggle);
      } else {
        initThemeToggle();
      }
    })();
  </script>

</body>

</html>
